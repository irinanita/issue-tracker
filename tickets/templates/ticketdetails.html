{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% load initialavatar %}

{% block content %}

    <div class="row mt-4 mt-md-5">
        <div class="col-sm-12 col-md-auto">
            <h3 class="card-title">{{ ticket.title }}</h3>
        </div>
        <div class="col-sm-12 col-md-auto">
            <span class="badge badge-secondary badge-pill ml-2">{{ ticket.status }}</span>
            <span class="badge badge-secondary badge-pill ml-2">{{ ticket.type }}</span>
            <span class="badge badge-secondary badge-pill ml-2">{{ ticket.label }}</span>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 ">
            <span class="mr-3 text-secondary">Author: {{ ticket.user }}</span>
            <span class="text-secondary"> Created: {{ ticket.creation_date }} </span>
            <span class="float-right">Votes: {{ ticket.score }}</span>
        </div>
    </div>
    <hr>
    <div class="row mt-3">
        {% if ticket.image %}
            <div class="col-12 col-md-8">
                <img class="img-fluid" src="{{ MEDIA_URL }}{{ ticket.image }}"/>
            </div>
        {% endif %}
        <div class="col-12 col-md mt-3 mt-md-0">
            <h5>Description</h5>
            <p>{{ ticket.description }}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-auto ml-auto">
            <span><a class="ticket-vote" href="{% url 'upvote' ticket.id %}"><i class="fas fa-plus-circle mr-2"></i>UpVote</a></span>
        </div>
    </div>
    <hr/>
    <h5 class="text-center">Comments</h5>
    {% for comment in comments %}
        <div class="row">
            <div class="col-md-2">
            <div class="row d-none d-md-flex">
                {% if comment.user.userprofile.avatar %}
                    <div class="img-container rounded-circle ml-auto mr-auto"
                         style="background-image: url('{{ comment.user.userprofile.avatar.url }}'); background-size: cover; background-repeat: no-repeat; height:64px;width:64px">
                    </div>
                {% else %}
                    <div class="img-container ml-auto mr-auto">
                        {% get_initial_avatar comment.user 64 'circle' %}
                    </div>
                {% endif %}
            </div>
            <div class=" comment-author row text-muted">
                 <span class="d-none d-md-inline-block mr-md-auto ml-md-auto">{{ comment.user.username }}</span>
            </div>

            </div>
            <div class="col-md-10 comment-content">
                <p>{{ comment.content }}</p>
                <p class="text-right text-muted">
                    <small class=" mr-2 mr-md-0 comment-date">
                        <span class="d-inline d-md-none text-left">{{ comment.user.username }},</span> {{ comment.creation_date }}</small>
                </p>
            </div>
        </div>
        <hr>
    {% endfor %}
    <h5 class="text-center mt-4">Add a comment:</h5>
    <form method="POST" class="mr-auto ml-auto col-xs-12 col-lg-8 clearfix">
        {% csrf_token %}
        {{ add_comment_form | crispy }}
        <button class="btn btn-success float-right mt-3" type="submit">Add Comment</button>
    </form>
{% endblock %}
